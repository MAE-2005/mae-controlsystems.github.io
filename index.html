<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MAE Academy</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #e2efff;
      --ink: #0b0b0b;
      --card: #ffffff;
      --muted: #556;
      --accent: #0b63ff;
      --shadow: rgba(0,0,0,0.08);
      --border: 2px solid var(--ink);
      --radius-xl: 22px;
      --radius-lg: 16px;
    }

    *{ box-sizing:border-box; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Helvetica, Arial, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 24px;
      min-height: 100vh;
      color: var(--ink);
      display: flex;
      justify-content: center;
    }

    /* background blobs (nice but still “clean”) */
    .bg-blob{
      position: fixed;
      inset: auto auto -160px -160px;
      width: 420px;
      height: 420px;
      background: rgba(11,99,255,0.10);
      filter: blur(2px);
      border-radius: 999px;
      z-index: 0;
    }
    .bg-blob.blob2{
      inset: -180px -180px auto auto;
      width: 520px;
      height: 520px;
      background: rgba(0,0,0,0.05);
    }

    /* App wrapper */
    .app {
      width: 100%;
      max-width: 1200px;
      position: relative;
      z-index: 1;
    }

    /* Screen Management */
    .screen {
      display: none;
      width: 100%;
      min-height: calc(100vh - 48px);
      padding: 10px 0;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity .25s ease, transform .25s ease;
    }
    .active-screen {
      display: flex !important;
      opacity: 1;
      transform: translateY(0);
    }

    /* Home & Menu layout */
    #home-screen, #sim-menu-screen{
      align-items: center;
      justify-content: center;
      gap: 80px;
      flex-wrap: wrap;
      padding-top: 30px;
    }

    .left-content{
      display:flex;
      flex-direction:column;
      gap: 18px;
      z-index: 2;
      max-width: 520px;
    }
    .title-small{
      font-size: clamp(2.2rem, 4vw, 4rem);
      font-weight: 500;
      margin: 0;
      line-height: 1;
      letter-spacing: -2px;
    }
    .title-bold{
      font-size: clamp(2.8rem, 5vw, 5rem);
      font-weight: 900;
      margin: 0;
      line-height: 1;
      letter-spacing: -2px;
    }
    .subtitle{
      font-size: 1.15rem;
      margin: 8px 0 18px 0;
      font-weight: 600;
      color: #222;
    }

    /* Pills */
    .pill-btn{
      background: var(--card);
      border: var(--border);
      border-radius: 999px;
      padding: 16px 22px;
      font-size: 1.05rem;
      font-weight: 800;
      cursor: pointer;
      width: min(420px, 90vw);
      text-align: left;
      transition: transform .12s ease, background .12s ease;
      display:flex;
      align-items:center;
      justify-content:space-between;
      box-shadow: 0 6px 0 rgba(0,0,0,0.10);
      user-select: none;
    }
    .pill-btn:hover{ transform: translateY(-2px); background:#f8f9fa; }
    .pill-btn:active{ transform: translateY(2px); box-shadow:none; }

    /* ID Card */
    .id-card{
      background: var(--card);
      border: var(--border);
      border-radius: var(--radius-xl);
      width: 350px;
      height: 550px;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding: 22px;
      box-shadow: 18px 18px 0 var(--shadow);
    }
    .logo-box{ margin-bottom: 30px; }
    .card-title{
      font-size: 3.4rem;
      font-weight: 900;
      letter-spacing: 6px;
      margin: 8px 0;
    }
    .card-name{
      font-size: 1.05rem;
      font-weight: 800;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    /* Back Nav */
    .back-nav{
      width: 100%;
      max-width: 1100px;
      margin: 6px auto 14px auto;
      padding: 0 6px;
    }
    .back-btn{
      background:none;
      border:none;
      font-size: 1.05rem;
      font-weight: 900;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap: 8px;
      color:#222;
      padding: 8px 0;
    }
    .back-btn:hover{ color: var(--accent); }

    /* Simulator */
    #simulator-app{
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-bottom: 30px;
    }

    .sim-container{
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius-lg);
      box-shadow: 0 10px 30px rgba(0,0,0,0.10);
      width: min(1100px, 100%);
      border: 1px solid rgba(0,0,0,0.08);
    }

    .sim-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .sim-title{
      margin: 0;
      color: #222;
      font-size: 1.25rem;
      font-weight: 900;
    }
    .sim-badge{
      font-size: .9rem;
      font-weight: 800;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,0.15);
      background: rgba(11,99,255,0.08);
    }

    .visual-grid{
      display:grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      margin-bottom: 16px;
    }
    @media (max-width: 950px){
      .visual-grid{ grid-template-columns: 1fr; }
    }

    .panel-box{
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px;
      background: #fff;
    }
    .panel-title{
      font-weight: 900;
      color: #333;
      margin-bottom: 10px;
      display:block;
      border-bottom: 1px solid #eef0f3;
      padding-bottom: 8px;
      font-size: .95rem;
    }

    canvas{
      width: 100%;
      height: 350px;
      display:block;
      border-radius: 8px;
    }
    #sPlaneCanvas{ background: #fafafa; }

    .bottom-section{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    @media (max-width: 860px){
      .bottom-section{ grid-template-columns: 1fr; }
    }

    .controls{
      padding: 14px;
      background: #f8f9fa;
      border-radius: 12px;
      border: 1px solid #e9ecef;
    }
    .control-group{ margin-bottom: 14px; }
    .control-group label{
      display:flex;
      justify-content:space-between;
      font-weight: 800;
      margin-bottom: 6px;
      color:#222;
    }
    .control-group input[type="range"]{ width: 100%; cursor:pointer; }

    button.btn-step{
      background: var(--accent);
      color:white;
      border:none;
      padding: 12px 16px;
      border-radius: 10px;
      cursor:pointer;
      font-size: 14px;
      font-weight: 900;
      width: 100%;
      transition: filter .15s ease;
    }
    button.btn-step:hover{ filter: brightness(.92); }

    .math-panel{
      padding: 14px;
      background: #e3f2fd;
      border-radius: 12px;
      border: 1px solid #bbdefb;
      color: #0d47a1;
    }
    .math-title{
      font-weight: 900;
      margin-bottom: 10px;
      color: #0b3b86;
    }
    .equation{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
      font-weight: 900;
      background: rgba(255,255,255,0.70);
      padding: 10px;
      border-radius: 10px;
      text-align:center;
      margin-bottom: 12px;
      font-size: .95rem;
    }
    .metric{
      display:flex;
      justify-content:space-between;
      margin-bottom: 8px;
      font-size: .95rem;
      font-weight: 800;
    }

    .status-box{
      margin-top: 10px;
      padding: 10px;
      background: white;
      border-radius: 10px;
      text-align:center;
      font-weight: 900;
      font-size: .95rem;
      border-left: 6px solid transparent;
    }
    .status-stable{ color:#1b5e20; border-left-color:#1b5e20; }
    .status-unstable{ color:#b71c1c; border-left-color:#b71c1c; }
    .status-oscillating{ color:#e65100; border-left-color:#e65100; }
  </style>
</head>

<body>
  <div class="bg-blob"></div>
  <div class="bg-blob blob2"></div>

  <div class="app">
    <!-- HOME -->
    <div id="home-screen" class="screen active-screen">
      <div class="left-content">
        <div>
          <h1 class="title-small">Welcome to</h1>
          <h1 class="title-bold">MAE Academy</h1>
          <p class="subtitle">Learn & Enjoy</p>
        </div>

        <button class="pill-btn" onclick="alert('Courses module coming soon!')">
          Academic Courses <span>→</span>
        </button>
        <button class="pill-btn" onclick="navigateTo('sim-menu-screen')">
          Practical Simulations <span>→</span>
        </button>
      </div>

      <div class="id-card">
        <div class="logo-box">
          <svg width="120" height="100" viewBox="0 0 100 80" aria-label="MAE Logo">
            <path d="M10,10 L30,60 L50,10 L70,60 L90,10 L80,70 L20,70 Z"
                  fill="none" stroke="black" stroke-width="6" stroke-linejoin="round"/>
            <line x1="20" y1="78" x2="80" y2="78" stroke="black" stroke-width="6"/>
          </svg>
        </div>
        <div class="card-title">MAE</div>
        <div class="card-name">MOHAMMAD ABU ELYAN</div>
      </div>
    </div>

    <!-- SIM MENU -->
    <div id="sim-menu-screen" class="screen">
      <div class="back-nav">
        <button class="back-btn" onclick="navigateTo('home-screen')">← Back to Home</button>
      </div>

      <div class="left-content" style="align-items:center; width:100%;">
        <h1 class="title-small" style="font-size: 3rem;">Simulations</h1>
        <p class="subtitle">Select a module to begin</p>

        <button class="pill-btn" onclick="startProcessControl()">
          Process Control and Control Systems <span>▶</span>
        </button>

        <button class="pill-btn" style="opacity:.55; cursor:not-allowed;" disabled>
          Fluid Mechanics (Coming Soon)
        </button>
      </div>
    </div>

    <!-- SIMULATOR -->
    <div id="simulator-app" class="screen">
      <div class="back-nav">
        <button class="back-btn" onclick="navigateTo('sim-menu-screen')">← Back to Menu</button>
      </div>

      <div class="sim-container">
        <div class="sim-head">
          <h2 class="sim-title">PID Simulator with S-Plane Analysis</h2>
          <div class="sim-badge">Plant: 1 / (s(s+0.1))</div>
        </div>

        <div class="visual-grid">
          <div class="panel-box">
            <span class="panel-title">Time Domain Response (Step Response)</span>
            <canvas id="simCanvas"></canvas>
          </div>

          <div class="panel-box">
            <span class="panel-title">S-Plane (Pole Locations)</span>
            <canvas id="sPlaneCanvas"></canvas>
          </div>
        </div>

        <div class="bottom-section">
          <div class="controls">
            <div class="control-group">
              <label>Set Point (SP): <span id="val-sp">50</span></label>
              <input type="range" id="inp-sp" min="0" max="100" value="50" />
            </div>

            <div class="control-group">
              <label>Proportional (Kp): <span id="val-kp">20</span></label>
              <input type="range" id="inp-kp" min="0" max="100" step="1" value="20" />
            </div>

            <div class="control-group">
              <label>Integral (Ki): <span id="val-ki">10</span></label>
              <input type="range" id="inp-ki" min="0" max="100" step="1" value="10" />
            </div>

            <div class="control-group">
              <label>Derivative (Kd): <span id="val-kd">5</span></label>
              <input type="range" id="inp-kd" min="0" max="100" step="1" value="5" />
            </div>

            <button class="btn-step" onclick="triggerStep()">Trigger Step Change</button>
          </div>

          <div class="math-panel">
            <div class="math-title">Characteristic Equation</div>
            <div class="equation" id="char-eq-display">s³ + As² + Bs + C = 0</div>

            <div class="metric">
              <span>Calculated Poles (Roots):</span>
            </div>
            <div id="roots-display" style="font-family: ui-monospace, Menlo, Consolas, monospace; margin-left: 8px; font-size: .9rem;">
              --
            </div>

            <div id="status-display" class="status-box status-stable">System Stable</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------- Screen Navigation --------
    function navigateTo(screenId) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
      document.getElementById(screenId).classList.add('active-screen');
      // when entering simulator, ensure canvas sizing is correct
      if (screenId === 'simulator-app' && simInitialized) resizeCanvases();
    }

    function startProcessControl() {
      navigateTo('simulator-app');
      if (!simInitialized) {
        initSim();
        simInitialized = true;
      }
    }

    // -------- Simulator State --------
    let simInitialized = false;
    let canvas, ctx, sCanvas, sCtx, dpr = 1;

    let state = { pv: 0, velocity: 0, integral: 0, lastError: 0, time: 0 };
    let historyPV = [];
    let historySP = [];
    const maxHistory = 420;

    let inputs = { sp: 50, kp: 20, ki: 10, kd: 5 };

    function initSim() {
      canvas = document.getElementById('simCanvas');
      ctx = canvas.getContext('2d');
      sCanvas = document.getElementById('sPlaneCanvas');
      sCtx = sCanvas.getContext('2d');

      setupEvents();
      resizeCanvases();
      window.addEventListener('resize', resizeCanvases);

      loop();
    }

    // Make canvases crisp (retina)
    function resizeCanvases() {
      dpr = window.devicePixelRatio || 1;

      const setSize = (c, w, h) => {
        c.style.width = w + 'px';
        c.style.height = h + 'px';
        c.width = Math.floor(w * dpr);
        c.height = Math.floor(h * dpr);
      };

      const simRect = canvas.getBoundingClientRect();
      const spRect  = sCanvas.getBoundingClientRect();

      setSize(canvas, simRect.width, simRect.height);
      setSize(sCanvas, spRect.width, spRect.height);

      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      sCtx.setTransform(dpr, 0, 0, dpr, 0, 0);

      updateAnalysis();
      drawGraph();
    }

    // -------- Physics (simple PID + double-integrator-ish plant) --------
    function updatePhysics() {
      const dt = 0.05;
      const error = inputs.sp - state.pv;

      const P = inputs.kp * error;
      state.integral += error * dt;
      const I = inputs.ki * state.integral;
      const D = inputs.kd * (error - state.lastError) / dt;

      const output = P + I + D;

      const damping = 0.1;
      const acceleration = output - (damping * state.velocity);

      state.velocity += acceleration * dt;
      state.pv += state.velocity * dt;

      state.lastError = error;
      state.time += dt;

      historyPV.push(state.pv);
      historySP.push(inputs.sp);
      if (historyPV.length > maxHistory) { historyPV.shift(); historySP.shift(); }
    }

    // -------- Cubic solver (Cardano) for s^3 + a s^2 + b s + c = 0 --------
    function solveCharacteristicEq(kp, ki, kd) {
      // Closed-loop: s^3 + (0.1 + Kd)s^2 + (Kp)s + (Ki) = 0
      const a = 0.1 + kd;
      const b = kp;
      const c = ki;

      // Depressed cubic: t^3 + p t + q = 0 where s = t - a/3
      const p = (3*b - a*a) / 3;
      const q = (2*a*a*a - 9*a*b + 27*c) / 27;
      const delta = (q*q)/4 + (p*p*p)/27;

      const roots = [];

      if (Math.abs(delta) < 1e-10) {
        const u = Math.cbrt(-q/2);
        const t1 = 2*u;
        const t2 = -u;
        roots.push({ re: t1 - a/3, im: 0 });
        roots.push({ re: t2 - a/3, im: 0 });
        roots.push({ re: t2 - a/3, im: 0 });
      } else if (delta > 0) {
        const u = Math.cbrt(-q/2 + Math.sqrt(delta));
        const v = Math.cbrt(-q/2 - Math.sqrt(delta));
        const t1 = u + v;

        roots.push({ re: t1 - a/3, im: 0 });

        const realPart = -(u+v)/2 - a/3;
        const imagPart = (u-v) * Math.sqrt(3)/2;
        roots.push({ re: realPart, im: imagPart });
        roots.push({ re: realPart, im: -imagPart });
      } else {
        // 3 real roots
        const r = Math.sqrt(-p*p*p / 27);
        const phi = Math.acos((-q/2) / r);
        const m = 2 * Math.sqrt(-p/3);

        const x1 = m * Math.cos(phi/3) - a/3;
        const x2 = m * Math.cos((phi + 2*Math.PI)/3) - a/3;
        const x3 = m * Math.cos((phi + 4*Math.PI)/3) - a/3;

        roots.push({ re: x1, im: 0 });
        roots.push({ re: x2, im: 0 });
        roots.push({ re: x3, im: 0 });
      }

      return roots;
    }

    // -------- Analysis UI + S-plane --------
    function updateAnalysis() {
      const kp = +inputs.kp;
      const ki = +inputs.ki;
      const kd = +inputs.kd;

      const aVal = (0.1 + kd).toFixed(2);
      document.getElementById('char-eq-display').innerText =
        `s³ + ${aVal}s² + ${kp}s + ${ki} = 0`;

      const roots = solveCharacteristicEq(kp, ki, kd);

      let rootStr = "";
      let isStable = true;
      let isOscillating = false;

      roots.forEach(r => {
        if (r.re > 0.01) isStable = false;
        if (Math.abs(r.im) > 0.01) isOscillating = true;

        const re = r.re.toFixed(2);
        const im = Math.abs(r.im).toFixed(2);
        rootStr += `s = ${re}${Math.abs(r.im) > 0.001 ? ` ± j${im}` : ""}<br>`;
      });

      document.getElementById('roots-display').innerHTML = rootStr;

      const statusBox = document.getElementById('status-display');
      if (!isStable) {
        statusBox.innerText = "UNSTABLE (Poles in RHP)";
        statusBox.className = "status-box status-unstable";
      } else if (isOscillating) {
        statusBox.innerText = "STABLE but OSCILLATING (Complex Poles)";
        statusBox.className = "status-box status-oscillating";
      } else {
        statusBox.innerText = "STABLE & OVERDAMPED (Real Poles)";
        statusBox.className = "status-box status-stable";
      }

      drawSPlane(roots);
    }

    function drawSPlane(roots) {
      const w = sCanvas.getBoundingClientRect().width;
      const h = sCanvas.getBoundingClientRect().height;

      sCtx.clearRect(0, 0, w, h);

      const cx = w/2 + 40;
      const cy = h/2;
      const scale = 14;

      // Axes
      sCtx.strokeStyle = "#cfcfcf";
      sCtx.lineWidth = 1;

      sCtx.beginPath(); sCtx.moveTo(0, cy); sCtx.lineTo(w, cy); sCtx.stroke();
      sCtx.beginPath(); sCtx.moveTo(cx, 0); sCtx.lineTo(cx, h); sCtx.stroke();

      sCtx.fillStyle = "#666";
      sCtx.font = "12px Inter, Arial";
      sCtx.fillText("Real (σ)", w - 70, cy - 8);
      sCtx.fillText("Imag (jω)", cx + 8, 18);

      // Roots
      roots.forEach(r => {
        const x = cx + r.re * scale;
        const y = cy - r.im * scale;
        drawX(sCtx, x, y, "#d32f2f");
      });
    }

    function drawX(c, x, y, color) {
      const size = 7;
      c.strokeStyle = color;
      c.lineWidth = 2;
      c.beginPath();
      c.moveTo(x - size, y - size);
      c.lineTo(x + size, y + size);
      c.moveTo(x + size, y - size);
      c.lineTo(x - size, y + size);
      c.stroke();
    }

    // -------- Time response graph --------
    function drawGraph() {
      const w = canvas.getBoundingClientRect().width;
      const h = canvas.getBoundingClientRect().height;

      ctx.clearRect(0, 0, w, h);

      // Grid + labels
      ctx.font = "12px Inter, Arial";
      ctx.fillStyle = "#7a7a7a";
      ctx.strokeStyle = "#eeeeee";
      ctx.lineWidth = 1;

      ctx.beginPath();
      [0, 25, 50, 75, 100, 125].forEach(val => {
        const y = mapY(val, h);
        ctx.moveTo(36, y);
        ctx.lineTo(w, y);
        ctx.fillText(val, 8, y + 4);
      });
      ctx.stroke();

      // SP dashed
      ctx.beginPath();
      ctx.setLineDash([7, 7]);
      ctx.strokeStyle = "#9aa0a6";
      ctx.lineWidth = 2;
      historySP.forEach((val, i) => {
        const x = (i / maxHistory) * w;
        const y = mapY(val, h);
        (i === 0) ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      });
      ctx.stroke();

      // PV solid
      ctx.beginPath();
      ctx.setLineDash([]);
      ctx.strokeStyle = "#0b63ff";
      ctx.lineWidth = 2;
      historyPV.forEach((val, i) => {
        const x = (i / maxHistory) * w;
        const y = mapY(val, h);
        (i === 0) ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      });
      ctx.stroke();
    }

    function mapY(val, h) {
      // map roughly -20..140 to canvas height
      return h - ((val + 20) / 160) * h;
    }

    // -------- Loop --------
    function loop() {
      if (document.getElementById('simulator-app').classList.contains('active-screen')) {
        updatePhysics();
        drawGraph();
      }
      requestAnimationFrame(loop);
    }

    // -------- Inputs --------
    function setupEvents() {
      ["sp", "kp", "ki", "kd"].forEach(id => {
        document.getElementById("inp-" + id).addEventListener("input", (e) => {
          inputs[id] = +e.target.value;
          document.getElementById("val-" + id).innerText = inputs[id];
          updateAnalysis();
        });
      });
      updateAnalysis();
    }

    function triggerStep() {
      inputs.sp = (inputs.sp === 50) ? 80 : 50;
      document.getElementById("inp-sp").value = inputs.sp;
      document.getElementById("val-sp").innerText = inputs.sp;
    }
  </script>
</body>
</html>
